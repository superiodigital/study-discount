<main id="main">
  <!-- banner of the page -->
  <section class="banner banner3 bg-full overlay"
    style="background-image: url(/main-images/study-discount-about-us.jpg);">
    <div class="holder">
      <div class="container">
        <div class="row">
          <div class="col-xs-12 text-center">
            <h2 class="" style="color: #ffb300;">Study Discount</h2>
            <h1>{{offer.name}}</h1>
          </div>
        </div>
      </div>
    </div>
  </section>
  <section>
    <a href="#offerFormForRegistration" class="btn-primary text-center text-uppercase button-responsiveness">Apply
      Now!</a>
  </section>
  <!-- twocolumns of the page -->
  <div class="twocolumns pad-top-lg pad-bottom-lg">
    <div class="container">
      <div class="row">
        <div class="col-xs-12">
          <!-- content of the page -->
          <article id="content">
            <!-- post detail of the page -->
            <div class="post-detail style2">
              <div class="img-holder">
                <img src="/uploads/{{offer.offerImage}}" alt="{{offer.shortDescription}}" class="img-responsive">
              </div>
              <div class="txt-holder">
                <header class="header">
                  {{!-- <div class="coupon-logo">
                    <img src="/user/images/logo01.png" alt="Red Cart" class="img-responsive">
                  </div> --}}
                  <div class="align-left">
                    <h3 class="heading3">{{offer.shortDescription}}</h3>
                    <ul class="list-unstyled list-show">
                      <li title="Verified"><i class="fa-solid fa-circle-check"></i> Verified</li>
                      <li><i class="fa-solid fa-eye"></i> {{offer.viewedCount}}</li>
                      <li><i class="icon icon-user"></i>{{registeredCount}}</li>
                    </ul>
                  </div>
                </header>
                <div id="long-content">
                  <!-- Handlebars will render the decoded HTML here -->
                </div>
                {{!-- facebook comment section --}}
                <hr>
                <div id="fb-root"></div>
                <script async defer crossorigin="anonymous"
                  src="https://connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v17.0" nonce="qWou8bxW"></script>
                <div class="fb-comments" data-href="https://www.study.discount/offers-details/{{offer._id}}"
                  data-width="100%" data-numposts="10"></div>
              </div>
            </div>
          </article>
          <!-- sidebar of the page -->
          <aside id="sidebar">
            <section class="widget popular-widget" id="offerFormForRegistration">
              <h3 class="heading4">Apply for this offer</h3>
              <form id="offerForm">
                <div class="col" style="margin-top: 15px;">
                  <input type="text" class="form-control register-form-field" style="background-color:white;"
                    placeholder="Name*" name="name" required />
                  <span class="error-message" id="name-error" style="color: red; font-size: 12px;"></span>
                </div>
                <div class="col" style="margin-top: 15px;">
                  <input type="text" class="form-control register-form-field" style="background-color:white;"
                    placeholder="Email*" name="email" required />
                  <span class="error-message" id="email-error" style="color: red; font-size: 12px;"></span>
                </div>
                <div class="col" style="margin-top: 15px;">
                  <input type="text" class="form-control register-form-field" style="background-color:white;"
                    placeholder="Phone*" name="phone" required />
                  <span class="error-message" id="phone-error" style="color: red; font-size: 12px;"></span>
                </div>
                {{!-- offerId --}}
                <input type="text" value="{{offer._id}}" name="offerId" readonly hidden />
                <div class="tacbox">
                  <input class="tacinput" id="checkbox" type="checkbox" name="isTermsAccepted" checked />
                  <label for="checkbox"> I agree to these <a href="/terms-and-conditions"
                      style="color: rgb(0, 21, 255);text-decoration: underline;">Terms and Conditions</a>.</label>
                </div>
                <div class="col d-flex" style="margin-top: 15px;">
                  <button class="btn-primary text-center text-uppercase" style="width: 100%;" type="button"
                    id="submitDetails">Apply Now!</button> 
                </div>
              </form>

            </section>
            <!-- Spinner of the page -->
            {{!-- <section>
              <div>
                <h1>Spin the wheel for exclusive offers</h1>
                <div id="chart"></div>
                <div id="question">
                  <h1></h1>
                </div>
              </div>
            </section> --}}
          </aside>
        </div>
      </div>
    </div>
  </div>
  {{#if relatedOffers}}
  <section class="latest-coupon container pad-top-lg pad-bottom-md">
    <div class="row">
      <header class="col-xs-12 text-center header">
        <h2 class="heading">Related Offers</h2>
      </header>
    </div>
    <div class="row">
      {{#each relatedOffers}}
      <div class="col-xs-12 col-sm-6 col-md-4">
        <div class="coupon-box mar-bottom-xs">
          <div class="img-holder">
            <a href="/offers-details/{{_id}}" title="{{shortDescription}}"><img src="/uploads/{{offerImage}}"
                alt="{{shortDescription}}" class="img-resposnive" /></a>
          </div>
          <div class="txt-holder">
            <h3 class="heading6" style="">
              <a href="/offers-details/{{_id}}" title="{{shortDescription}}"
                id="description-link-{{_id}}">{{shortDescription}}</a>
            </h3>
            <a href="/offers-details/{{_id}}" class="btn-primary md-round text-center text-uppercase mt-5">Get Offer</a>
            <time class="time text-center" datetime="{{expiresFrom}}">Expires On: {{expiresTo}}</time>
          </div>
        </div>
      </div>
      {{/each}}
    </div>
  </section>
  {{/if}}
</main>

<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="/user/js/wheel.js"></script>

<script>
  // Get the encoded HTML content from your offer object
  const encodedHTML = "{{offer.longDescription}}";

  // Create a temporary element
  const tempElement = document.createElement('div');

  // Set its innerHTML to the encoded HTML
  tempElement.innerHTML = encodedHTML;

  // Get the decoded text using innerText
  const decodedHTML = tempElement.innerText;

  // Get the target <div> where you want to display the decoded HTML
  const contentDiv = document.getElementById('long-content');

  // Set the decoded HTML as the innerHTML of the target <div>
  contentDiv.innerHTML = decodedHTML;
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
  $(document).ready(function () {
    // Handle form submission via AJAX
    $("#submitDetails").click(function () {
      // Reset previous error messages
      $(".error-message").text("");

      // Validate the form fields
      var name = $("input[name='name']").val();
      var email = $("input[name='email']").val();
      var phone = $("input[name='phone']").val();

      var isValid = true;

      // Validate name (required)
      if (name === "") {
        isValid = false;
        $("#name-error").text("Name is required");
      }

      // Validate email (required and basic format)
      if (email === "") {
        isValid = false;
        $("#email-error").text("Email is required");
      } else if (!isValidEmail(email)) {
        isValid = false;
        $("#email-error").text("Invalid email format");
      }

      // Validate phone (required and numeric)
      if (phone === "") {
        isValid = false;
        $("#phone-error").text("Phone is required");
      } else if (!isValidPhone(phone)) {
        isValid = false;
        $("#phone-error").text("Invalid phone number format");
      }

      // If the form is valid, submit it via AJAX
      if (isValid) {
        var formData = $("#offerForm").serialize();

        $.ajax({
          type: "POST",
          url: "/offers-registration",
          data: formData,
          success: function (response) {
            if (response.status === true) {
              console.log("Form submitted successfully");
              alert("Form submitted successfully!");
              location.reload()
            }
          },
          error: function (error) {
            console.error("Error submitting form:", error);
            alert("An error occurred while submitting the form. Please try again.");
          }
        });
      }
    });

    // Helper functions for email and phone validation
    function isValidEmail(email) {
      // You can implement a more robust email validation regex if needed
      var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    }

    function isValidPhone(phone) {
      // You can implement more specific phone number validation if needed
      var phoneRegex = /^[0-9]+$/;
      return phoneRegex.test(phone);
    }
  });
</script>